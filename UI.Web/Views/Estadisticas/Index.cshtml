@{
    ViewData["Title"] = "Estadísticas del Sistema";
}

<div class="container mt-4">
<div class="row">
     <div class="col-md-12">
   <h2 class="text-center mb-4">Estadísticas del Sistema</h2>
       <p class="text-center text-muted">Resumen de todos los servicios disponibles</p>
        </div>
    </div>

    @if (ViewBag.Error != null)
    {
 <div class="alert alert-danger">
      <strong>Error:</strong> @ViewBag.Error
  </div>
    }
    else
    {
        <div class="row mt-4">
     <!-- Card de Clientes -->
         <div class="col-md-3 mb-3">
    <div class="card border-primary shadow">
         <div class="card-header bg-primary text-white">
          <h6 class="mb-0"><i class="bi bi-people-fill"></i> Clientes</h6>
       </div>
       <div class="card-body text-center">
       <h2 class="display-4 text-primary">@ViewBag.TotalClientes</h2>
       <p class="text-muted mb-0">Clientes Registrados</p>
    </div>
  </div>
      </div>

   <!-- Card de Salones -->
      <div class="col-md-3 mb-3">
      <div class="card border-success shadow">
        <div class="card-header bg-success text-white">
   <h6 class="mb-0"><i class="bi bi-door-closed"></i> Salones</h6>
      </div>
   <div class="card-body text-center">
      <h2 class="display-4 text-success">@ViewBag.TotalSalones</h2>
<p class="text-muted mb-0">Salones Disponibles</p>
       </div>
       </div>
       </div>

    <!-- Card de Barras -->
    <div class="col-md-3 mb-3">
     <div class="card border-warning shadow">
      <div class="card-header bg-warning">
       <h6 class="mb-0"><i class="bi bi-cup-straw"></i> Barras</h6>
     </div>
       <div class="card-body text-center">
  <h2 class="display-4 text-warning">@ViewBag.TotalBarras</h2>
<p class="text-muted mb-0">Barras Disponibles</p>
   </div>
  </div>
   </div>

 <!-- Card de DJs -->
      <div class="col-md-3 mb-3">
 <div class="card border-info shadow">
   <div class="card-header bg-info text-white">
           <h6 class="mb-0"><i class="bi bi-disc"></i> DJs</h6>
     </div>
     <div class="card-body text-center">
  <h2 class="display-4 text-info">@ViewBag.TotalDjs</h2>
 <p class="text-muted mb-0">DJs Disponibles</p>
    </div>
      </div>
  </div>
   </div>

      <div class="row">
     <!-- Card de Gastronómicos -->
<div class="col-md-4 mb-3">
   <div class="card border-danger shadow">
          <div class="card-header bg-danger text-white">
      <h6 class="mb-0"><i class="bi bi-egg-fried"></i> Servicios Gastronómicos</h6>
  </div>
   <div class="card-body text-center">
      <h2 class="display-4 text-danger">@ViewBag.TotalGastronomicos</h2>
      <p class="text-muted mb-0">Servicios Disponibles</p>
        </div>
     </div>
       </div>

 <!-- Card de Zonas -->
 <div class="col-md-4 mb-3">
    <div class="card border-secondary shadow">
  <div class="card-header bg-secondary text-white">
   <h6 class="mb-0"><i class="bi bi-map"></i> Zonas</h6>
     </div>
 <div class="card-body text-center">
   <h2 class="display-4 text-secondary">@ViewBag.TotalZonas</h2>
      <p class="text-muted mb-0">Zonas Registradas</p>
    </div>
     </div>
    </div>

         <!-- Card de Total General -->
  <div class="col-md-4 mb-3">
<div class="card border-dark shadow">
 <div class="card-header bg-dark text-white">
      <h6 class="mb-0"><i class="bi bi-grid-3x3"></i> Total Servicios</h6>
  </div>
     <div class="card-body text-center">
   <h2 class="display-4 text-dark">@(ViewBag.TotalSalones + ViewBag.TotalBarras + ViewBag.TotalDjs + ViewBag.TotalGastronomicos)</h2>
   <p class="text-muted mb-0">Servicios Totales</p>
    </div>
       </div>
    </div>
   </div>

        <!-- Gráficos -->
      <div class="row mt-5">
  <div class="col-md-6 mb-4">
       <div class="card shadow">
          <div class="card-header bg-primary text-white">
     <h5 class="mb-0"><i class="bi bi-bar-chart-fill"></i> Distribución de Servicios</h5>
        </div>
    <div class="card-body">
      <canvas id="chartServicios" height="300"></canvas>
       </div>
  </div>
       </div>

 <div class="col-md-6 mb-4">
       <div class="card shadow">
          <div class="card-header bg-success text-white">
   <h5 class="mb-0"><i class="bi bi-pie-chart-fill"></i> Estadísticas Generales</h5>
     </div>
             <div class="card-body">
    <canvas id="chartEstadisticas" height="300"></canvas>
  </div>
       </div>
            </div>
  </div>

   <!-- Tablas de detalle -->
   <div class="row mt-4">
      <div class="col-md-12">
<div class="card shadow">
 <div class="card-header bg-success text-white">
      <h5 class="mb-0"><i class="bi bi-table"></i> Listado de Salones</h5>
        </div>
        <div class="card-body">
        <div class="table-responsive">
  <table class="table table-striped table-hover">
 <thead class="table-dark">
   <tr>
  <th>ID</th>
    <th>Nombre del Salón</th>
   <th>Estado</th>
      <th class="text-end">Monto</th>
   </tr>
    </thead>
 <tbody>
           @if (ViewBag.Salones != null)
  {
       @foreach (var salon in ViewBag.Salones)
  {
         <tr>
      <td>@salon.IdSalon</td>
        <td>@salon.NombreSalon</td>
     <td>
 <span class="badge @(salon.Estado == "Disponible" ? "bg-success" : "bg-warning")">
   @salon.Estado
  </span>
 </td>
    <td class="text-end">@salon.MontoSalon.ToString("C")</td>
      </tr>
       }
    }
  </tbody>
    </table>
    </div>
  </div>
     </div>
   </div>
</div>

        <div class="row mt-4">
  <div class="col-md-12">
    <div class="card shadow">
 <div class="card-header bg-warning">
    <h5 class="mb-0"><i class="bi bi-table"></i> Listado de Barras</h5>
          </div>
    <div class="card-body">
<div class="table-responsive">
         <table class="table table-striped table-hover">
        <thead class="table-dark">
  <tr>
  <th>ID</th>
<th>Nombre</th>
<th>Tipo de Bebida</th>
        <th>Estado</th>
 <th class="text-end">Precio por Hora</th>
        </tr>
 </thead>
    <tbody>
  @if (ViewBag.Barras != null)
  {
@foreach (var barra in ViewBag.Barras)
         {
 <tr>
    <td>@barra.IdBarra</td>
           <td>@barra.Nombre</td>
           <td>@barra.TipoBebida</td>
   <td>
    <span class="badge @(barra.Estado == "Disponible" ? "bg-success" : "bg-warning")">
   @barra.Estado
  </span>
   </td>
 <td class="text-end">@barra.PrecioPorHora.ToString("C")</td>
   </tr>
  }
          }
           </tbody>
    </table>
   </div>
    </div>
</div>
   </div>
</div>

  <div class="row mt-4">
     <div class="col-md-12">
   <div class="card shadow">
       <div class="card-header bg-info text-white">
  <h5 class="mb-0"><i class="bi bi-table"></i> Listado de DJs</h5>
      </div>
       <div class="card-body">
 <div class="table-responsive">
     <table class="table table-striped table-hover">
       <thead class="table-dark">
  <tr>
        <th>ID</th>
          <th>Nombre Artístico</th>
 <th>Estado</th>
   <th class="text-end">Monto</th>
 </tr>
  </thead>
   <tbody>
   @if (ViewBag.Djs != null)
 {
 @foreach (var dj in ViewBag.Djs)
   {
<tr>
     <td>@dj.IdDj</td>
       <td>@dj.NombreArtistico</td>
 <td>
        <span class="badge @(dj.Estado == "Disponible" ? "bg-success" : "bg-warning")">
        @dj.Estado
   </span>
        </td>
     <td class="text-end">@dj.MontoDj.ToString("C")</td>
         </tr>
}
 }
 </tbody>
    </table>
       </div>
        </div>
  </div>
  </div>
  </div>

      <div class="row mt-4 mb-4">
    <div class="col-md-12">
       <div class="card shadow">
     <div class="card-header bg-danger text-white">
     <h5 class="mb-0"><i class="bi bi-table"></i> Listado de Servicios Gastronómicos</h5>
     </div>
 <div class="card-body">
     <div class="table-responsive">
      <table class="table table-striped table-hover">
    <thead class="table-dark">
    <tr>
      <th>ID</th>
 <th>Nombre del Servicio</th>
     <th>Tipo de Comida</th>
<th class="text-end">Monto</th>
 </tr>
    </thead>
   <tbody>
    @if (ViewBag.Gastronomicos != null)
       {
      @foreach (var gastro in ViewBag.Gastronomicos)
    {
       <tr>
 <td>@gastro.IdGastro</td>
       <td>@gastro.Nombre</td>
  <td>@gastro.TipoComida</td>
  <td class="text-end">@gastro.MontoG.ToString("C")</td>
  </tr>
         }
      }
        </tbody>
 </table>
         </div>
           </div>
         </div>
 </div>
      </div>
    }
</div>

<div class="text-center mt-4 mb-4">
 <a asp-controller="Home" asp-action="Index" class="btn btn-primary">
   <i class="bi bi-house"></i> Volver al Inicio
  </a>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script>
    // Gráfico de Barras - Distribución de Servicios
    const ctxServicios = document.getElementById('chartServicios');
    if (ctxServicios) {
        new Chart(ctxServicios, {
 type: 'bar',
   data: {
     labels: ['Salones', 'Barras', 'DJs', 'Gastronómicos'],
  datasets: [{
label: 'Cantidad de Servicios',
         data: [@ViewBag.TotalSalones, @ViewBag.TotalBarras, @ViewBag.TotalDjs, @ViewBag.TotalGastronomicos],
       backgroundColor: [
   'rgba(40, 167, 69, 0.7)',
                 'rgba(255, 193, 7, 0.7)',
             'rgba(23, 162, 184, 0.7)',
         'rgba(220, 53, 69, 0.7)'
           ],
          borderColor: [
            'rgb(40, 167, 69)',
               'rgb(255, 193, 7)',
       'rgb(23, 162, 184)',
      'rgb(220, 53, 69)'
     ],
       borderWidth: 2
  }]
     },
            options: {
       responsive: true,
     maintainAspectRatio: false,
         plugins: {
    legend: {
   display: false
      },
        title: {
    display: true,
     text: 'Servicios Disponibles por Categoría',
               font: {
        size: 16
    }
         }
    },
            scales: {
y: {
         beginAtZero: true,
      ticks: {
          stepSize: 1
              }
          }
   }
       }
  });
    }

  // Gráfico Circular - Estadísticas Generales
    const ctxEstadisticas = document.getElementById('chartEstadisticas');
  if (ctxEstadisticas) {
        const totalServicios = @ViewBag.TotalSalones + @ViewBag.TotalBarras + @ViewBag.TotalDjs + @ViewBag.TotalGastronomicos;
    
        new Chart(ctxEstadisticas, {
      type: 'doughnut',
            data: {
    labels: ['Salones', 'Barras', 'DJs', 'Gastronómicos'],
       datasets: [{
  label: 'Distribución',
           data: [@ViewBag.TotalSalones, @ViewBag.TotalBarras, @ViewBag.TotalDjs, @ViewBag.TotalGastronomicos],
     backgroundColor: [
     'rgba(40, 167, 69, 0.8)',
       'rgba(255, 193, 7, 0.8)',
    'rgba(23, 162, 184, 0.8)',
             'rgba(220, 53, 69, 0.8)'
                    ],
         borderColor: [
    'rgb(40, 167, 69)',
         'rgb(255, 193, 7)',
         'rgb(23, 162, 184)',
     'rgb(220, 53, 69)'
        ],
       borderWidth: 2
    }]
        },
       options: {
    responsive: true,
            maintainAspectRatio: false,
    plugins: {
         legend: {
       position: 'bottom'
   },
                 title: {
     display: true,
    text: 'Distribución Porcentual de Servicios',
           font: {
              size: 16
 }
           },
          tooltip: {
           callbacks: {
   label: function(context) {
             let label = context.label || '';
    let value = context.parsed;
          let percentage = totalServicios > 0 ? ((value / totalServicios) * 100).toFixed(1) : 0;
            return label + ': ' + value + ' (' + percentage + '%)';
                  }
     }
           }
   }
            }
        });
    }
</script>
